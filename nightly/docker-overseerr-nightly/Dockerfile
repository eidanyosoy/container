## This file is automatically generated (based on release.json)
##
## Do not changes any lines here
##
####################################
# All rights reserved.              #
# started from Zero                 #
# Docker owned dockserver           #
# Docker Maintainer dockserver      #
#####################################
#####################################
# THIS DOCKER IS UNDER LICENSE      #
# NO CUSTOMIZING IS ALLOWED         #
# NO REBRANDING IS ALLOWED          #
# NO CODE MIRRORING IS ALLOWED      #
#####################################
# shellcheck disable=SC2086
# shellcheck disable=SC2046
FROM ghcr.io/dockserver/docker-alpine:latest
LABEL org.opencontainers.image.source="https://github.com/dockserver/container"

ARG TARGETPLATFORM
ARG BUILDPLATFORM

ARG VERSION="8942eb8b7c4fa1d16aa2e72e8ba7120a653c9aa2"
ARG BRANCH="develop"

ENV HOME="/config"

RUN \
  echo "**** install packages ****" && \
    apk add -U --update --no-cache --virtual=build-dependencies curl g++ jq make python3 && \
  echo "**** symlink python3 for compatibility ****" && \
    ln -s /usr/bin/python3 /usr/bin/python && \
  echo "**** install runtime packages ****" && \
    apk add -U --update --no-cache jq yarn curl wget tar && \
    export COMMIT_TAG="${VERSION}" && \
  echo "**** install 'docker-overseerr-nightly' ****" && \
    mkdir -p /app/overseerr && \
    curl -fsSL "https://github.com/sct/overseerr/archive/${VERSION}.tar.gz" | tar xzf - -C /app/overseerr --strip-components=1 && \
    cd /app/overseerr && \
    export NODE_OPTIONS=--max_old_space_size=2048 && \
    yarn --frozen-lockfile --network-timeout 1000000 && \
    yarn build && yarn install --production --ignore-scripts --prefer-offline && \
    yarn cache clean && \
    rm -rf /app/overseerr/src /app/overseerr/server /app/overseerr/Dockerfile && \
  echo "{\"commitTag\": \"${COMMIT_TAG}\"}" > committag.json && \
    rm -rf /app/overseerr/config && \
    ln -s /config /app/overseerr/config && \
    touch /config/DOCKER && \
  echo "**** cleanup ****" && \
    apk del --purge build-dependencies && \
    rm -rf /root/.cache /tmp/* /app/overseerr/.next/cache/*

COPY --chown=abc ./apps/docker-overseerr/root/ /

EXPOSE 5055
VOLUME /config
##EOF
